<%= breadcrumb([
  @campaign.organization.name,
    {href: admin_organization_url(@campaign.organization), label: 'Campaigns'}
  ])
%>
<%
catalogs = @books.keys.uniq{|u| u[0]}.collect{|u|u[0]}


catalogs.each do |catalog|
  book_total = 0
  price_total = 0
%>
<h2><%= catalog %></h2>
<h3><%= @campaign.organization.name %> - <%= @campaign.name %></h3>
<h4><%= @campaign.deadline %></h4>
<table class="table table-striped table-condensed">
  <thead>
    <tr>
      <th>ISBN</th>
      <th>Title</th>
      <th class="text-right">Unit Price</th>
      <th class="text-right">QTY</th>
      <th class="text-right">Subtotal</th>
    </tr>
  </thead>
  <tbody>
<% @books.each do |key, count|
  if key[0] == catalog
    book_total += count
    price_total += @prices[key]
-%>
    <tr>
      <td><%= key[1] %></td>
      <td><%= key[2] %></td>
      <td class="text-right"><%= number_to_currency(@prices[key]/count) %></td>
      <td class="text-right"><%= count %></td>
      <td class="text-right"><%= number_to_currency(@prices[key]) %></td>
    </tr>
<%
  end
end -%>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="3" class="text-right"><strong>Totals:</strong></td>
      <td class="text-right"><%= book_total %></td>
      <td class="text-right"><%= number_to_currency(price_total) %></td>
    </tr>
  </tfoot>
</table>
<% end -%>
